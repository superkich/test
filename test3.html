<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marvel Avengers: Мультиплеер</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: url('https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 0;
            color: white;
            overflow-x: hidden;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ec1d24;
        }
        
        .header h1 {
            color: #ec1d24;
            margin: 0;
            font-size: 3em;
            text-shadow: 2px 2px 4px #000;
            font-family: 'Marvel', sans-serif;
        }
        
        .header p {
            color: #f0f0f0;
            font-size: 1.2em;
        }
        
        .game-board {
            display: flex;
            flex-direction: column;
            min-height: 700px;
        }
        
        .player-area {
            display: flex;
            flex-direction: column;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            background-color: rgba(30, 30, 30, 0.7);
            border: 2px solid #333;
            position: relative;
        }
        
        .player1-area {
            border-color: #3b4cca;
        }
        
        .player2-area {
            border-color: #cc0000;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .player-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
            font-family: 'Marvel', sans-serif;
        }
        
        .player1-name {
            color: #3b4cca;
        }
        
        .player2-name {
            color: #cc0000;
        }
        
        .health-container {
            display: flex;
            align-items: center;
        }
        
        .health {
            font-size: 1.3em;
            font-weight: bold;
            margin-right: 10px;
            color: #ff0000;
        }
        
        .health-bar {
            width: 200px;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(to right, #ff0000, #ff6b6b);
            transition: width 0.3s;
        }
        
        .energy {
            display: flex;
            align-items: center;
        }
        
        .energy-icon {
            color: #ffd700;
            font-size: 1.5em;
            margin-right: 5px;
        }
        
        .energy-count {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffd700;
        }
        
        .board {
            display: flex;
            justify-content: space-around;
            min-height: 200px;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 1px solid #444;
        }
        
        .minion-slot {
            width: 120px;
            height: 160px;
            background-color: rgba(50, 50, 50, 0.7);
            border: 2px dashed #555;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #777;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        
        .minion-slot:hover {
            border-color: #ffd700;
        }
        
        .hand {
            display: flex;
            justify-content: center;
            min-height: 180px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            margin-top: auto;
        }
        
        .card {
            width: 100px;
            height: 150px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 8px;
            margin: 0 5px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid #444;
        }
        
        .card:hover {
            transform: translateY(-20px) scale(1.1);
            z-index: 10;
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.5);
            border-color: #ffd700;
        }
        
        .card-hero {
            background: linear-gradient(135deg, #b21f1f, #ec1d24);
        }
        
        .card-villain {
            background: linear-gradient(135deg, #1f1fb2, #1d1dec);
        }
        
        .card-ability {
            background: linear-gradient(135deg, #1fb21f, #1dec1d);
        }
        
        .card-cost {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: #ffd700;
            color: #000;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .card-image {
            width: 60px;
            height: 60px;
            margin: 0 auto;
            background-color: #333;
            border-radius: 5px;
            background-size: cover;
            background-position: center;
        }
        
        .card-name {
            font-weight: bold;
            text-align: center;
            font-size: 0.8em;
            margin: 5px 0;
            color: #fff;
            text-shadow: 1px 1px 1px #000;
        }
        
        .card-description {
            font-size: 0.7em;
            text-align: center;
            color: #ddd;
        }
        
        .card-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        
        .card-attack, .card-health {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.8em;
        }
        
        .card-attack {
            background-color: #cc0000;
            color: white;
        }
        
        .card-health {
            background-color: #00cc00;
            color: white;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(to right, #ec1d24, #b21f1f);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4);
            background: linear-gradient(to right, #ff0000, #cc0000);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-end-turn {
            background: linear-gradient(to right, #3b4cca, #1a2b8f);
        }
        
        .btn-end-turn:hover {
            background: linear-gradient(to right, #4b5cda, #2a3b9f);
        }
        
        .message-area {
            text-align: center;
            margin: 20px 0;
            min-height: 30px;
            font-size: 1.2em;
            color: #ffd700;
            text-shadow: 1px 1px 2px #000;
        }
        
        .minion-card {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            border: 1px solid #555;
        }
        
        .minion-card:hover {
            border-color: #ffd700;
        }
        
        .minion-image {
            width: 50px;
            height: 50px;
            background-size: cover;
            background-position: center;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        
        .minion-name {
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .minion-stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        
        .minion-attack, .minion-health {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }
        
        .minion-attack {
            background-color: #cc0000;
        }
        
        .minion-health {
            background-color: #00cc00;
        }
        
        .hero-power {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(255, 215, 0, 0.3);
            border: 2px solid #ffd700;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .hero-power:hover {
            background-color: rgba(255, 215, 0, 0.5);
            transform: translateY(-50%) scale(1.1);
        }
        
        .hero-power-icon {
            color: #ffd700;
            font-size: 1.5em;
        }
        
        .turn-indicator {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ec1d24;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes cardDraw {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .new-card {
            animation: cardDraw 0.5s ease-out;
        }
        
        @keyframes attackAnimation {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        
        .attacking {
            animation: attackAnimation 0.3s ease-in-out;
        }
        
        @keyframes damageAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #ff0000; }
            100% { transform: scale(1); }
        }
        
        .taking-damage {
            animation: damageAnimation 0.3s ease-in-out;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            border: 3px solid #ec1d24;
            box-shadow: 0 0 30px rgba(236, 29, 36, 0.5);
            text-align: center;
        }
        
        .modal-title {
            color: #ec1d24;
            font-size: 2em;
            margin-bottom: 20px;
            font-family: 'Marvel', sans-serif;
        }
        
        .modal-text {
            color: #fff;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .modal-btn {
            padding: 12px 30px;
            background: linear-gradient(to right, #ec1d24, #b21f1f);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(236, 29, 36, 0.7);
        }
        
        .lobby {
            text-align: center;
            margin-top: 50px;
        }
        
        .game-id-display {
            font-size: 1.5em;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: inline-block;
        }
        
        .game-link {
            color: #ffd700;
            text-decoration: none;
            font-weight: bold;
            word-break: break-all;
        }
        
        .waiting-message {
            font-size: 1.5em;
            color: #ffd700;
            margin: 30px 0;
        }
        
        .player-role {
            font-size: 1.2em;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(236, 29, 36, 0.3);
            display: inline-block;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Marvel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <div id="lobby" class="lobby">
        <div class="header">
            <h1>MARVEL AVENGERS</h1>
            <p>Мультиплеерная карточная битва</p>
        </div>
        
        <div id="create-game-section">
            <button class="btn" id="create-game-btn">Создать игру</button>
            <div class="modal-text">Или присоединиться по ID:</div>
            <input type="text" id="game-id-input" placeholder="Введите ID игры" style="padding: 10px; border-radius: 5px; border: none; margin: 10px;">
            <button class="btn" id="join-game-btn">Присоединиться</button>
        </div>
        
        <div id="game-info" style="display: none;">
            <div class="game-id-display">
                ID игры: <span id="game-id" class="game-link"></span>
            </div>
            <div id="waiting-message" class="waiting-message">
                Ожидаем второго игрока...
            </div>
            <div id="player-role" class="player-role"></div>
        </div>
    </div>
    
    <div id="game-container" class="game-container" style="display: none;">
        <div class="header">
            <h1>MARVEL AVENGERS</h1>
            <p>Карточная битва - <span id="game-status"></span></p>
        </div>
        
        <div class="game-board">
            <!-- Игрок 2 (противник) -->
            <div class="player-area player2-area">
                <div class="player-info">
                    <div class="player-name player2-name" id="opponent-name">Противник</div>
                    <div class="health-container">
                        <div class="health" id="opponent-health">30</div>
                        <div class="health-bar">
                            <div class="health-fill" id="opponent-health-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="energy">
                        <div class="energy-icon"><i class="fas fa-bolt"></i></div>
                        <div class="energy-count" id="opponent-energy">1</div>
                    </div>
                </div>
                
                <div class="board" id="opponent-board">
                    <!-- Миньоны противника -->
                    <div class="minion-slot" id="opponent-slot-1"></div>
                    <div class="minion-slot" id="opponent-slot-2"></div>
                    <div class="minion-slot" id="opponent-slot-3"></div>
                    <div class="minion-slot" id="opponent-slot-4"></div>
                    <div class="minion-slot" id="opponent-slot-5"></div>
                    <div class="minion-slot" id="opponent-slot-6"></div>
                    <div class="minion-slot" id="opponent-slot-7"></div>
                </div>
                
                <div class="hand" id="opponent-hand">
                    <!-- Карты противника (скрыты) -->
                    <div class="card card-villain" style="visibility: hidden;"></div>
                    <div class="card card-villain" style="visibility: hidden;"></div>
                    <div class="card card-villain" style="visibility: hidden;"></div>
                    <div class="card card-villain" style="visibility: hidden;"></div>
                </div>
            </div>
            
            <!-- Область сообщений -->
            <div class="message-area" id="message">
                Добро пожаловать в битву Мстителей!
            </div>
            
            <!-- Игрок 1 (вы) -->
            <div class="player-area player1-area">
                <div class="turn-indicator" id="turn-indicator">Ваш ход</div>
                <div class="player-info">
                    <div class="player-name player1-name" id="player-name">Капитан Америка</div>
                    <div class="health-container">
                        <div class="health" id="player-health">30</div>
                        <div class="health-bar">
                            <div class="health-fill" id="player-health-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="energy">
                        <div class="energy-icon"><i class="fas fa-bolt"></i></div>
                        <div class="energy-count" id="player-energy">1</div>
                    </div>
                    <div class="hero-power">
                        <div class="hero-power-icon"><i class="fas fa-shield-alt"></i></div>
                    </div>
                </div>
                
                <div class="board" id="player-board">
                    <!-- Ваши миньоны -->
                    <div class="minion-slot" id="player-slot-1"></div>
                    <div class="minion-slot" id="player-slot-2"></div>
                    <div class="minion-slot" id="player-slot-3"></div>
                    <div class="minion-slot" id="player-slot-4"></div>
                    <div class="minion-slot" id="player-slot-5"></div>
                    <div class="minion-slot" id="player-slot-6"></div>
                    <div class="minion-slot" id="player-slot-7"></div>
                </div>
                
                <div class="hand" id="player-hand">
                    <!-- Ваши карты -->
                    <div class="card card-hero">
                        <div class="card-cost">1</div>
                        <div class="card-image" style="background-image: url('https://i.annihil.us/u/prod/marvel/i/mg/9/50/537ba56d31087.jpg');"></div>
                        <div class="card-name">Железный Человек</div>
                        <div class="card-description">Дает +2 к броне</div>
                        <div class="card-stats">
                            <div class="card-attack">2</div>
                            <div class="card-health">3</div>
                        </div>
                    </div>
                    <div class="card card-hero">
                        <div class="card-cost">2</div>
                        <div class="card-image" style="background-image: url('https://i.annihil.us/u/prod/marvel/i/mg/3/50/526548a343e4b.jpg');"></div>
                        <div class="card-name">Черная Вдова</div>
                        <div class="card-description">Контратакует при атаке</div>
                        <div class="card-stats">
                            <div class="card-attack">3</div>
                            <div class="card-health">2</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" id="end-turn-btn">Завершить ход</button>
            <button class="btn btn-end-turn" id="hero-power-btn">Сила героя (2)</button>
        </div>
    </div>
    
    <!-- Модальное окно окончания игры -->
    <div class="modal" id="end-game-modal">
        <div class="modal-content">
            <div class="modal-title">Игра окончена!</div>
            <div class="modal-text" id="end-game-text">Капитан Америка побеждает!</div>
            <button class="modal-btn" id="restart-btn">Новая игра</button>
        </div>
    </div>
    
    <script>
        // Ваш актуальный конфиг
                    const firebaseConfig = {
            apiKey: "AIzaSyBiT2tkvoJq1yz5SEiH2xgn46fY2-9uIG8",
            authDomain: "kich-e896f.firebaseapp.com",
            databaseURL: "https://kich-e896f-default-rtdb.firebaseio.com",
            projectId: "kich-e896f",
            storageBucket: "kich-e896f.firebasestorage.app",
            messagingSenderId: "108033571342",
            appId: "1:108033571342:web:a76bca35108f5de2765a5f",
            measurementId: "G-LBEFGE9C57"
};
      
        // Инициализация
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
      
        
        // Игровые данные
        const heroes = [
            { id: 1, name: "Железный Человек", cost: 1, attack: 2, health: 3, image: "https://i.annihil.us/u/prod/marvel/i/mg/9/50/537ba56d31087.jpg", description: "Дает +2 к броне", type: "hero" },
            { id: 2, name: "Черная Вдова", cost: 2, attack: 3, health: 2, image: "https://i.annihil.us/u/prod/marvel/i/mg/3/50/526548a343e4b.jpg", description: "Контратакует при атаке", type: "hero" },
            { id: 3, name: "Тор", cost: 3, attack: 4, health: 4, image: "https://i.annihil.us/u/prod/marvel/i/mg/3/60/53176bb096d17.jpg", description: "Может атаковать дважды за ход", type: "hero" },
            { id: 4, name: "Халк", cost: 4, attack: 6, health: 5, image: "https://i.annihil.us/u/prod/marvel/i/mg/5/a0/538615ca33ab0.jpg", description: "Ярость: +2 к атаке при повреждении", type: "hero" },
            { id: 5, name: "Соколиный Глаз", cost: 2, attack: 3, health: 3, image: "https://i.annihil.us/u/prod/marvel/i/mg/8/20/5109a1a93b4a1.jpg", description: "Меткость: всегда попадает", type: "hero" }
        ];
        
        const villains = [
            { id: 101, name: "Танос", cost: 10, attack: 8, health: 12, image: "https://i.annihil.us/u/prod/marvel/i/mg/6/40/5274137e3e2cd.jpg", description: "Перчатка Бесконечности: уничтожает случайного миньона", type: "villain" },
            { id: 102, name: "Локи", cost: 3, attack: 3, health: 4, image: "https://i.annihil.us/u/prod/marvel/i/mg/d/90/526547f509313.jpg", description: "Иллюзии: уклонение 50%", type: "villain" },
            { id: 103, name: "Ультрон", cost: 4, attack: 5, health: 5, image: "https://i.annihil.us/u/prod/marvel/i/mg/6/30/53176ff199596.jpg", description: "Самовосстановление: +1 здоровье каждый ход", type: "villain" },
            { id: 104, name: "Ртуть", cost: 2, attack: 4, health: 2, image: "https://i.annihil.us/u/prod/marvel/i/mg/6/70/526547e6d6e6e.jpg", description: "Скорость: атакует первым", type: "villain" },
            { id: 105, name: "Барон Земо", cost: 3, attack: 2, health: 5, image: "https://i.annihil.us/u/prod/marvel/i/mg/6/70/5260315b979f3.jpg", description: "Тактика: +1 к атаке всех миньонов", type: "villain" }
        ];
        
        const abilities = [
            { id: 201, name: "Щит Капитана", cost: 2, image: "https://i.annihil.us/u/prod/marvel/i/mg/9/90/4bb4eea6c5c7b.jpg", description: "Блокирует следующую атаку", type: "ability" },
            { id: 202, name: "Молот Тора", cost: 3, image: "https://i.annihil.us/u/prod/marvel/i/mg/6/30/537bc581b7c1b.jpg", description: "Наносит 4 урона выбранной цели", type: "ability" },
            { id: 203, name: "Реактор Арка", cost: 1, image: "https://i.annihil.us/u/prod/marvel/i/mg/6/a0/55b6a25e654f6.jpg", description: "Восстанавливает 3 здоровья", type: "ability" },
            { id: 204, name: "Паучье чутье", cost: 2, image: "https://i.annihil.us/u/prod/marvel/i/mg/9/30/538cd3e724150.jpg", description: "Позволяет разыграть дополнительную карту", type: "ability" },
            { id: 205, name: "Луч Доктора Стрэнджа", cost: 4, image: "https://i.annihil.us/u/prod/marvel/i/mg/5/f0/5261a85a501fe.jpg", description: "Уничтожает случайного вражеского миньона", type: "ability" }
        ];
        
        // Игровые переменные
        let gameId = null;
        let playerRole = null; // 'player1' или 'player2'
        let playerName = "";
        let opponentName = "";
        let playerHealth = 30;
        let opponentHealth = 30;
        let playerEnergy = 1;
        let opponentEnergy = 1;
        let currentTurn = 1;
        let isPlayerTurn = false;
        let selectedCard = null;
        let selectedTarget = null;
        let playerDeck = [];
        let opponentDeck = [];
        let playerHand = [];
        let opponentHand = [];
        let playerBoard = [];
        let opponentBoard = [];
        
        // DOM элементы
        const lobbyElement = document.getElementById('lobby');
        const gameContainerElement = document.getElementById('game-container');
        const createGameBtn = document.getElementById('create-game-btn');
        const joinGameBtn = document.getElementById('join-game-btn');
        const gameIdInput = document.getElementById('game-id-input');
        const gameInfoElement = document.getElementById('game-info');
        const gameIdElement = document.getElementById('game-id');
        const waitingMessageElement = document.getElementById('waiting-message');
        const playerRoleElement = document.getElementById('player-role');
        const playerHandElement = document.getElementById('player-hand');
        const playerHealthElement = document.getElementById('player-health');
        const opponentHealthElement = document.getElementById('opponent-health');
        const playerHealthBar = document.getElementById('player-health-bar');
        const opponentHealthBar = document.getElementById('opponent-health-bar');
        const playerEnergyElement = document.getElementById('player-energy');
        const opponentEnergyElement = document.getElementById('opponent-energy');
        const messageElement = document.getElementById('message');
        const endTurnBtn = document.getElementById('end-turn-btn');
        const heroPowerBtn = document.getElementById('hero-power-btn');
        const endGameModal = document.getElementById('end-game-modal');
        const endGameText = document.getElementById('end-game-text');
        const restartBtn = document.getElementById('restart-btn');
        const turnIndicator = document.getElementById('turn-indicator');
        const playerNameElement = document.getElementById('player-name');
        const opponentNameElement = document.getElementById('opponent-name');
        const gameStatusElement = document.getElementById('game-status');
        
        // Создание новой игры
        createGameBtn.addEventListener('click', () => {
            playerName = prompt("Введите ваше имя:", "Капитан Америка") || "Капитан Америка";
            gameId = generateGameId();
            playerRole = 'player1';
            
            // Создаем игру в Firebase
            database.ref('games/' + gameId).set({
                player1: {
                    name: playerName,
                    ready: true,
                    health: 30,
                    energy: 1,
                    hand: [],
                    board: []
                },
                player2: {
                    name: "",
                    ready: false,
                    health: 30,
                    energy: 1,
                    hand: [],
                    board: []
                },
                currentTurn: 1,
                currentPlayer: 'player1',
                status: 'waiting'
            });
            
            // Показываем информацию об игре
            document.getElementById('create-game-section').style.display = 'none';
            gameInfoElement.style.display = 'block';
            gameIdElement.textContent = gameId;
            playerRoleElement.textContent = "Вы играете за Мстителей";
            
            // Копируем ссылку в буфер обмена
            const gameLink = window.location.href.split('?')[0] + '?game=' + gameId;
            gameIdElement.innerHTML = `<a href="${gameLink}" class="game-link">${gameId}</a>`;
            
            // Начинаем слушать изменения в игре
            setupGameListener();
        });
        
        // Присоединение к существующей игре
        joinGameBtn.addEventListener('click', () => {
            const joinGameId = gameIdInput.value.trim();
            if (!joinGameId) {
                alert("Пожалуйста, введите ID игры");
                return;
            }
            
            playerName = prompt("Введите ваше имя:", "Танос") || "Танос";
            playerRole = 'player2';
            gameId = joinGameId;
            
            // Проверяем существование игры
            database.ref('games/' + gameId).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const gameData = snapshot.val();
                    if (gameData.status === 'waiting') {
                        // Присоединяемся к игре
                        database.ref('games/' + gameId + '/player2').update({
                            name: playerName,
                            ready: true
                        });
                        
                        database.ref('games/' + gameId).update({
                            status: 'in-progress'
                        });
                        
                        // Показываем информацию об игре
                        document.getElementById('create-game-section').style.display = 'none';
                        gameInfoElement.style.display = 'block';
                        gameIdElement.textContent = gameId;
                        playerRoleElement.textContent = "Вы играете за Злодеев";
                        waitingMessageElement.textContent = "Присоединяемся к игре...";
                        
                        // Начинаем слушать изменения в игре
                        setupGameListener();
                    } else {
                        alert("Эта игра уже началась или завершена");
                    }
                } else {
                    alert("Игра с таким ID не найдена");
                }
            });
        });
        
        // Генерация ID игры
        function generateGameId() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }
        
        // Настройка слушателя изменений в игре
        function setupGameListener() {
            database.ref('games/' + gameId).on('value', (snapshot) => {
                const gameData = snapshot.val();
                if (!gameData) return;
                
                // Обновляем статус игры
                gameStatusElement.textContent = gameData.status === 'waiting' ? 'Ожидание игрока...' : 'Идет игра';
                
                // Если игра началась, переключаемся на игровое поле
                if (gameData.status === 'in-progress' && lobbyElement.style.display !== 'none') {
                    lobbyElement.style.display = 'none';
                    gameContainerElement.style.display = 'block';
                    
                    // Устанавливаем имена игроков
                    playerNameElement.textContent = gameData.player1.name;
                    opponentNameElement.textContent = gameData.player2.name;
                    
                    // Инициализируем игру
                    initGame();
                }
                
                // Обновляем состояние игры в зависимости от роли игрока
                if (playerRole === 'player1') {
                    updatePlayerState(gameData.player1, gameData.player2);
                    isPlayerTurn = gameData.currentPlayer === 'player1';
                } else {
                    updatePlayerState(gameData.player2, gameData.player1);
                    isPlayerTurn = gameData.currentPlayer === 'player2';
                }
                
                // Обновляем интерфейс
                updateTurnIndicator();
                updateGameState();
                
                // Если игра завершена
                if (gameData.status === 'finished') {
                    endGame(gameData.winner === playerRole ? "Вы победили!" : "Вы проиграли!");
                }
            });
            
            // Проверяем, есть ли ID игры в URL (для присоединения по ссылке)
            const urlParams = new URLSearchParams(window.location.search);
            const gameParam = urlParams.get('game');
            if (gameParam) {
                gameIdInput.value = gameParam;
            }
        }
        
        // Обновление состояния игрока
        function updatePlayerState(playerData, opponentData) {
            playerHealth = playerData.health;
            opponentHealth = opponentData.health;
            playerEnergy = playerData.energy;
            opponentEnergy = opponentData.energy;
            playerHand = playerData.hand || [];
            opponentHand = opponentData.hand || [];
            playerBoard = playerData.board || [];
            opponentBoard = opponentData.board || [];
        }
        
        // Обновление состояния игры
        function updateGameState() {
            updateHealth();
            updateEnergy();
            renderPlayerHand();
            updateBoards();
            
            if (isPlayerTurn) {
                showMessage("Ваш ход! У вас " + playerEnergy + " энергии.", "info");
            } else {
                showMessage("Ход противника. Ожидание...", "info");
            }
        }
        
        // Инициализация игры
        function initGame() {
            // Создаем колоды
            playerDeck = playerRole === 'player1' ? createDeck('hero') : createDeck('villain');
            opponentDeck = playerRole === 'player1' ? createDeck('villain') : createDeck('hero');
            
            // Перемешиваем колоды
            shuffleDeck(playerDeck);
            shuffleDeck(opponentDeck);
            
            // Раздаем начальные руки
            const initialHand = drawCards(playerDeck, 3);
            
            // Обновляем данные в Firebase
            const updates = {};
            updates[playerRole + '/hand'] = initialHand;
            updates[playerRole + '/deck'] = playerDeck;
            updates['opponentDeck'] = opponentDeck;
            
            database.ref('games/' + gameId).update(updates);
        }
        
        // Создание колоды
        function createDeck(type) {
            const deck = [];
            const characters = type === 'hero' ? heroes : villains;
            
            // Добавляем персонажей
            for (let i = 0; i < 10; i++) {
                const randomChar = characters[Math.floor(Math.random() * characters.length)];
                deck.push({...randomChar});
            }
            
            // Добавляем способности
            for (let i = 0; i < 5; i++) {
                const randomAbility = abilities[Math.floor(Math.random() * abilities.length)];
                deck.push({...randomAbility});
            }
            
            return deck;
        }
        
        // Перемешивание колоды
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        // Взятие карт из колоды
        function drawCards(deck, count) {
            const drawn = [];
            for (let i = 0; i < count; i++) {
                if (deck.length > 0) {
                    drawn.push(deck.pop());
                }
            }
            return drawn;
        }
        
        // Обновление здоровья
        function updateHealth() {
            playerHealthElement.textContent = playerHealth;
            opponentHealthElement.textContent = opponentHealth;
            playerHealthBar.style.width = `${(playerHealth / 30) * 100}%`;
            opponentHealthBar.style.width = `${(opponentHealth / 30) * 100}%`;
        }
        
        // Обновление энергии
        function updateEnergy() {
            playerEnergyElement.textContent = playerEnergy;
            opponentEnergyElement.textContent = opponentEnergy;
        }
        
        // Обновление поля
        function updateBoards() {
            // Очистка поля
            for (let i = 1; i <= 7; i++) {
                document.getElementById(`player-slot-${i}`).innerHTML = '';
                document.getElementById(`opponent-slot-${i}`).innerHTML = '';
            }
            
            // Отображение миньонов игрока
            playerBoard.forEach((minion, index) => {
                if (index < 7) {
                    const slot = document.getElementById(`player-slot-${index + 1}`);
                    renderMinion(minion, slot, true);
                }
            });
            
            // Отображение миньонов противника
            opponentBoard.forEach((minion, index) => {
                if (index < 7) {
                    const slot = document.getElementById(`opponent-slot-${index + 1}`);
                    renderMinion(minion, slot, false);
                }
            });
        }
        
        // Отображение миньона
        function renderMinion(minion, slot, isPlayer) {
            const minionElement = document.createElement('div');
            minionElement.className = 'minion-card';
            
            const image = document.createElement('div');
            image.className = 'minion-image';
            image.style.backgroundImage = `url(${minion.image})`;
            
            const name = document.createElement('div');
            name.className = 'minion-name';
            name.textContent = minion.name;
            
            const stats = document.createElement('div');
            stats.className = 'minion-stats';
            
            const attack = document.createElement('div');
            attack.className = 'minion-attack';
            attack.textContent = minion.attack;
            
            const health = document.createElement('div');
            health.className = 'minion-health';
            health.textContent = minion.health;
            
            stats.appendChild(attack);
            stats.appendChild(health);
            
            minionElement.appendChild(image);
            minionElement.appendChild(name);
            minionElement.appendChild(stats);
            
            // Добавляем обработчики событий для атаки
            if (isPlayer && isPlayerTurn && !minion.hasAttacked) {
                minionElement.style.cursor = 'pointer';
                minionElement.style.border = '1px solid gold';
                minionElement.addEventListener('click', () => selectMinionForAttack(minion));
            }
            
            slot.appendChild(minionElement);
        }
        
        // Отображение руки игрока
        function renderPlayerHand() {
            playerHandElement.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.type === 'villain' ? 'card-villain' : card.type === 'hero' ? 'card-hero' : 'card-ability'}`;
                
                const cost = document.createElement('div');
                cost.className = 'card-cost';
                cost.textContent = card.cost;
                
                const image = document.createElement('div');
                image.className = 'card-image';
                image.style.backgroundImage = `url(${card.image})`;
                
                const name = document.createElement('div');
                name.className = 'card-name';
                name.textContent = card.name;
                
                const desc = document.createElement('div');
                desc.className = 'card-description';
                desc.textContent = card.description;
                
                const stats = document.createElement('div');
                stats.className = 'card-stats';
                
                if (card.type !== 'ability') {
                    const attack = document.createElement('div');
                    attack.className = 'card-attack';
                    attack.textContent = card.attack;
                    
                    const health = document.createElement('div');
                    health.className = 'card-health';
                    health.textContent = card.health;
                    
                    stats.appendChild(attack);
                    stats.appendChild(health);
                }
                
                cardElement.appendChild(cost);
                cardElement.appendChild(image);
                cardElement.appendChild(name);
                cardElement.appendChild(desc);
                cardElement.appendChild(stats);
                
                // Добавляем обработчик для разыгрывания карты
                if (isPlayerTurn && card.cost <= playerEnergy) {
                    cardElement.addEventListener('click', () => playCard(index));
                } else {
                    cardElement.style.opacity = '0.6';
                }
                
                playerHandElement.appendChild(cardElement);
            });
        }
        
        // Разыгрывание карты
        function playCard(index) {
            const card = playerHand[index];
            
            if (card.cost > playerEnergy) {
                showMessage("Недостаточно энергии!", "error");
                return;
            }
            
            // Уменьшаем энергию
            playerEnergy -= card.cost;
            
            // Удаляем карту из руки
            playerHand.splice(index, 1);
            
            // Разные действия для разных типов карт
            if (card.type === 'hero' || card.type === 'villain') {
                // Добавляем героя/злодея на поле
                if (playerBoard.length < 7) {
                    const minion = {
                        ...card,
                        maxHealth: card.health,
                        hasAttacked: false
                    };
                    playerBoard.push(minion);
                    showMessage(`Вы разыграли ${card.name}!`, "success");
                } else {
                    showMessage("На поле нет места!", "error");
                }
            } else if (card.type === 'ability') {
                // Активируем способность
                activateAbility(card);
            }
            
            // Обновляем данные в Firebase
            const updates = {};
            updates[playerRole + '/hand'] = playerHand;
            updates[playerRole + '/board'] = playerBoard;
            updates[playerRole + '/energy'] = playerEnergy;
            
            database.ref('games/' + gameId).update(updates);
            
            // Обновляем интерфейс
            renderPlayerHand();
            updateBoards();
        }
        
        // Активация способности
        function activateAbility(ability) {
            switch (ability.id) {
                case 201: // Щит Капитана
                    showMessage("Щит Капитана активирован! Следующая атака будет заблокирована.", "success");
                    // Здесь должна быть логика эффекта
                    break;
                case 202: // Молот Тора
                    showMessage("Молот Тора наносит 4 урона выбранной цели!", "success");
                    // Здесь должна быть логика выбора цели и нанесения урона
                    break;
                case 203: // Реактор Арка
                    playerHealth = Math.min(30, playerHealth + 3);
                    updateHealth();
                    showMessage("Реактор Арка восстановил 3 здоровья!", "success");
                    
                    // Обновляем здоровье в Firebase
                    database.ref('games/' + gameId + '/' + playerRole + '/health').set(playerHealth);
                    break;
                // Другие способности...
                default:
                    showMessage(`Способность "${ability.name}" активирована!`, "success");
            }
        }
        
        // Выбор миньона для атаки
        function selectMinionForAttack(minion) {
            if (minion.hasAttacked) {
                showMessage("Этот миньон уже атаковал в этом ходу!", "error");
                return;
            }
            
            selectedCard = minion;
            showMessage(`Выберите цель для атаки ${minion.name}`, "info");
            
            // Подсвечиваем возможные цели
            opponentBoard.forEach((target, index) => {
                if (index < 7) {
                    const slot = document.getElementById(`opponent-slot-${index + 1}`);
                    if (slot.firstChild) {
                        slot.firstChild.style.border = "2px solid red";
                        slot.firstChild.style.cursor = "pointer";
                        slot.firstChild.addEventListener('click', () => attackTarget(target));
                    }
                }
            });
            
            // Также можно атаковать героя противника
            const opponentArea = document.querySelector('.player2-area');
            opponentArea.style.border = "2px solid red";
            opponentArea.style.cursor = "pointer";
            opponentArea.addEventListener('click', attackHero);
        }
        
        // Атака цели
        function attackTarget(target) {
            if (!selectedCard) return;
            
            // Анимация атаки
            const attackerIndex = playerBoard.indexOf(selectedCard);
            const attackerSlot = document.getElementById(`player-slot-${attackerIndex + 1}`);
            attackerSlot.firstChild.classList.add('attacking');
            
            setTimeout(() => {
                // Наносим урон
                target.health -= selectedCard.attack;
                selectedCard.health -= target.attack;
                
                // Проверяем на смерть миньонов
                if (selectedCard.health <= 0) {
                    playerBoard.splice(playerBoard.indexOf(selectedCard), 1);
                }
                
                const targetIndex = opponentBoard.indexOf(target);
                if (target.health <= 0) {
                    opponentBoard.splice(targetIndex, 1);
                }
                
                // Помечаем миньона как атаковавшего
                if (selectedCard.health > 0) {
                    selectedCard.hasAttacked = true;
                }
                
                // Обновляем данные в Firebase
                const updates = {};
                updates[playerRole + '/board'] = playerBoard;
                updates[(playerRole === 'player1' ? 'player2' : 'player1') + '/board'] = opponentBoard;
                
                database.ref('games/' + gameId).update(updates);
                
                // Сбрасываем выделение
                resetSelection();
                attackerSlot.firstChild.classList.remove('attacking');
                
                showMessage(`${selectedCard.name} атакует ${target.name}!`, "info");
            }, 300);
        }
        
        // Атака героя противника
        function attackHero() {
            if (!selectedCard) return;
            
            // Анимация атаки
            const attackerIndex = playerBoard.indexOf(selectedCard);
            const attackerSlot = document.getElementById(`player-slot-${attackerIndex + 1}`);
            attackerSlot.firstChild.classList.add('attacking');
            
            setTimeout(() => {
                // Наносим урон герою
                const opponentRole = playerRole === 'player1' ? 'player2' : 'player1';
                const newHealth = opponentHealth - selectedCard.attack;
                
                // Обновляем здоровье в Firebase
                database.ref('games/' + gameId + '/' + opponentRole + '/health').set(newHealth);
                
                // Помечаем миньона как атаковавшего
                selectedCard.hasAttacked = true;
                
                // Обновляем доску в Firebase
                database.ref('games/' + gameId + '/' + playerRole + '/board').set(playerBoard);
                
                // Сбрасываем выделение
                resetSelection();
                attackerSlot.firstChild.classList.remove('attacking');
                
                showMessage(`${selectedCard.name} атакует героя противника!`, "info");
            }, 300);
        }
        
        // Сброс выделения
        function resetSelection() {
            selectedCard = null;
            
            // Убираем подсветку с целей
            opponentBoard.forEach((_, index) => {
                if (index < 7) {
                    const slot = document.getElementById(`opponent-slot-${index + 1}`);
                    if (slot.firstChild) {
                        slot.firstChild.style.border = "1px solid #555";
                        slot.firstChild.style.cursor = "default";
                        slot.firstChild.replaceWith(slot.firstChild.cloneNode(true));
                    }
                }
            });
            
            const opponentArea = document.querySelector('.player2-area');
            opponentArea.style.border = "2px solid #333";
            opponentArea.style.cursor = "default";
        }
        
        // Завершение хода
        function endTurn() {
            const nextPlayer = playerRole === 'player1' ? 'player2' : 'player1';
            
            // Сбрасываем флаги атаки миньонов
            playerBoard.forEach(minion => {
                minion.hasAttacked = false;
            });
            
            // Берем карту из колоды
            if (playerDeck.length > 0 && playerHand.length < 10) {
                playerHand.push(playerDeck.pop());
                showMessage("Вы получили карту!", "success");
            }
            
            // Увеличиваем максимальную энергию (но не более 10)
            const newEnergy = Math.min(10, Math.floor((currentTurn + 1) / 2) + 1);
            
            // Обновляем данные в Firebase
            const updates = {
                currentPlayer: nextPlayer,
                currentTurn: currentTurn + 1,
                [playerRole + '/hand']: playerHand,
                [playerRole + '/deck']: playerDeck,
                [playerRole + '/board']: playerBoard,
                [playerRole + '/energy']: newEnergy
            };
            
            database.ref('games/' + gameId).update(updates);
            
            showMessage("Ход завершен. Ожидание хода противника...", "info");
        }
        
        // Использование силы героя
        function useHeroPower() {
            if (playerEnergy < 2) {
                showMessage("Недостаточно энергии для силы героя!", "error");
                return;
            }
            
            playerEnergy -= 2;
            
            // Эффект силы героя (защита - +2 здоровья всем миньонам)
            playerBoard.forEach(minion => {
                minion.health = Math.min(minion.maxHealth, minion.health + 2);
            });
            
            // Обновляем данные в Firebase
            const updates = {};
            updates[playerRole + '/energy'] = playerEnergy;
            updates[playerRole + '/board'] = playerBoard;
            
            database.ref('games/' + gameId).update(updates);
            
            showMessage("Сила героя активирована! Ваши миньоны получили +2 здоровья.", "success");
        }
        
        // Обновление индикатора хода
        function updateTurnIndicator() {
            if (isPlayerTurn) {
                turnIndicator.textContent = "Ваш ход";
                turnIndicator.style.display = "block";
                endTurnBtn.disabled = false;
                heroPowerBtn.disabled = false;
            } else {
                turnIndicator.style.display = "none";
                endTurnBtn.disabled = true;
                heroPowerBtn.disabled = true;
            }
        }
        
        // Показать сообщение
        function showMessage(text, type) {
            messageElement.textContent = text;
            messageElement.className = `message-area ${type}`;
        }
        
        // Конец игры
        function endGame(message) {
            endGameText.textContent = message;
            endGameModal.style.display = "flex";
        }
        
        // Перезапуск игры
        function restartGame() {
            endGameModal.style.display = "none";
            database.ref('games/' + gameId).remove();
            window.location.reload();
        }
        
        // События
        endTurnBtn.addEventListener('click', endTurn);
        heroPowerBtn.addEventListener('click', useHeroPower);
        restartBtn.addEventListener('click', restartGame);
    </script>
</body>
</html>